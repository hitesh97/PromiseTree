<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PromiseTree - A JavaScript Promise visualizer</title>

    <script>
        fetch = undefined;
        !function () {
            "use strict";
            function t(t) {
                if ("string" != typeof t && (t = t.toString()), /[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");
                return t.toLowerCase()
            }

            function e(t) {
                return "string" != typeof t && (t = t.toString()), t
            }

            function r(t) {
                this.map = {}, t instanceof r ? t.forEach(function (t, e) {
                    this.append(e, t)
                }, this) : t && Object.getOwnPropertyNames(t).forEach(function (e) {
                    this.append(e, t[e])
                }, this)
            }

            function o(t) {
                return t.bodyUsed ? Promise.reject(new TypeError("Already read")) : void(t.bodyUsed = !0)
            }

            function n(t) {
                return new Promise(function (e, r) {
                    t.onload = function () {
                        e(t.result)
                    }, t.onerror = function () {
                        r(t.error)
                    }
                })
            }

            function s(t) {
                var e = new FileReader;
                return e.readAsArrayBuffer(t), n(e)
            }

            function i(t) {
                var e = new FileReader;
                return e.readAsText(t), n(e)
            }

            function a() {
                return this.bodyUsed = !1, this._initBody = function (t) {
                    if (this._bodyInit = t, "string" == typeof t)this._bodyText = t; else if (p.blob && Blob.prototype.isPrototypeOf(t))this._bodyBlob = t; else if (p.formData && FormData.prototype.isPrototypeOf(t))this._bodyFormData = t; else {
                        if (t)throw new Error("unsupported BodyInit type");
                        this._bodyText = ""
                    }
                }, p.blob ? (this.blob = function () {
                    var t = o(this);
                    if (t)return t;
                    if (this._bodyBlob)return Promise.resolve(this._bodyBlob);
                    if (this._bodyFormData)throw new Error("could not read FormData body as blob");
                    return Promise.resolve(new Blob([this._bodyText]))
                }, this.arrayBuffer = function () {
                    return this.blob().then(s)
                }, this.text = function () {
                    var t = o(this);
                    if (t)return t;
                    if (this._bodyBlob)return i(this._bodyBlob);
                    if (this._bodyFormData)throw new Error("could not read FormData body as text");
                    return Promise.resolve(this._bodyText)
                }) : this.text = function () {
                    var t = o(this);
                    return t ? t : Promise.resolve(this._bodyText)
                }, p.formData && (this.formData = function () {
                    return this.text().then(h)
                }), this.json = function () {
                    return this.text().then(JSON.parse)
                }, this
            }

            function u(t) {
                var e = t.toUpperCase();
                return c.indexOf(e) > -1 ? e : t
            }

            function f(t, e) {
                if (e = e || {}, this.url = t, this.credentials = e.credentials || "omit", this.headers = new r(e.headers), this.method = u(e.method || "GET"), this.mode = e.mode || null, this.referrer = null, ("GET" === this.method || "HEAD" === this.method) && e.body)throw new TypeError("Body not allowed for GET or HEAD requests");
                this._initBody(e.body)
            }

            function h(t) {
                var e = new FormData;
                return t.trim().split("&").forEach(function (t) {
                    if (t) {
                        var r = t.split("="), o = r.shift().replace(/\+/g, " "), n = r.join("=").replace(/\+/g, " ");
                        e.append(decodeURIComponent(o), decodeURIComponent(n))
                    }
                }), e
            }

            function d(t) {
                var e = new r, o = t.getAllResponseHeaders().trim().split("\n");
                return o.forEach(function (t) {
                    var r = t.trim().split(":"), o = r.shift().trim(), n = r.join(":").trim();
                    e.append(o, n)
                }), e
            }

            function l(t, e) {
                e || (e = {}), this._initBody(t), this.type = "default", this.url = null, this.status = e.status, this.ok = this.status >= 200 && this.status < 300, this.statusText = e.statusText, this.headers = e.headers instanceof r ? e.headers : new r(e.headers), this.url = e.url || ""
            }

            if (!self.fetch) {
                r.prototype.append = function (r, o) {
                    r = t(r), o = e(o);
                    var n = this.map[r];
                    n || (n = [], this.map[r] = n), n.push(o)
                }, r.prototype["delete"] = function (e) {
                    delete this.map[t(e)]
                }, r.prototype.get = function (e) {
                    var r = this.map[t(e)];
                    return r ? r[0] : null
                }, r.prototype.getAll = function (e) {
                    return this.map[t(e)] || []
                }, r.prototype.has = function (e) {
                    return this.map.hasOwnProperty(t(e))
                }, r.prototype.set = function (r, o) {
                    this.map[t(r)] = [e(o)]
                }, r.prototype.forEach = function (t, e) {
                    Object.getOwnPropertyNames(this.map).forEach(function (r) {
                        this.map[r].forEach(function (o) {
                            t.call(e, o, r, this)
                        }, this)
                    }, this)
                };
                var p = {
                    blob: "FileReader"in self && "Blob"in self && function () {
                        try {
                            return new Blob, !0
                        } catch (t) {
                            return !1
                        }
                    }(), formData: "FormData"in self
                }, c = ["DELETE", "GET", "HEAD", "OPTIONS", "POST", "PUT"];
                a.call(f.prototype), a.call(l.prototype), self.Headers = r, self.Request = f, self.Response = l, self.fetch = function (t, e) {
                    var r;
                    return r = f.prototype.isPrototypeOf(t) && !e ? t : new f(t, e), new Promise(function (t, e) {
                        function o() {
                            return "responseURL"in n ? n.responseURL : /^X-Request-URL:/m.test(n.getAllResponseHeaders()) ? n.getResponseHeader("X-Request-URL") : void 0
                        }

                        var n = new XMLHttpRequest;
                        n.onload = function () {
                            var r = 1223 === n.status ? 204 : n.status;
                            if (100 > r || r > 599)return void e(new TypeError("Network request failed"));
                            var s = {
                                status: r,
                                statusText: n.statusText,
                                headers: d(n),
                                url: o()
                            }, i = "response"in n ? n.response : n.responseText;
                            t(new l(i, s))
                        }, n.onerror = function () {
                            e(new TypeError("Network request failed"))
                        }, n.open(r.method, r.url, !0), "include" === r.credentials && (n.withCredentials = !0), "responseType"in n && p.blob && (n.responseType = "blob"), r.headers.forEach(function (t, e) {
                            n.setRequestHeader(e, t)
                        }), n.send("undefined" == typeof r._bodyInit ? null : r._bodyInit)
                    })
                }, self.fetch.polyfill = !0
            }
        }();
    </script>

    <script src="../lib/promiseTree.js"></script>
    <script src="http://cdn.jsdelivr.net/ace/1.2.0/min/ace.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.1/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.1/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.1/ui-bootstrap-tpls.min.js"></script>
    <script src="bower_components/angular-ui-ace/ui-ace.min.js"></script>
    <script src="bower_components/angular-local-storage/dist/angular-local-storage.min.js"></script>


    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <style>
        body {
            color: #1ABC9C;
        }
        .btn {
            border-radius: 0;
        }
        .btn-success {
            background-color: #1ABC9C;
        }

        .btn-success:hover {
            background-color: #16A085;
        }

        .pt-header {
            color: #1ABC9C;
            font-weight: 900;
        }
        .pt-menu {
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .pt-menu li {
            line-height: 39px;
            margin: 10px 10px;
        }

        .pt-menu li a {
            cursor: pointer;
        }

        .action-box-container, .result-box-container {
            border: 1px solid gray;
        }
        .info-tooltip {
            color: #2980B9;
            cursor: help;
        }
        .tooltip.info-tooltip-box .tooltip-inner{
            background-color: #2980B9;
            color: #FFFFFF;
            font-size: 1.25em;
        }
        .tooltip.info-tooltip-box .tooltip-arrow {
            background-color: #2980B9;
        }

        .promise-node {
            display: inline-block;
            color: #ffffff;
            border-radius: 5px;
            padding: 5px;
            font-weight: bold;
        }

        .legend-row {
            margin-bottom: 20px;
            padding: 10px;
        }
        .promise-node.promise-node-promise {
            background-color: blue;
        }
        .promise-node.promise-node-then {
            background-color: green;
        }
        .promise-node.promise-node-catch {
            background-color: red;
        }
        .promise-node.promise-node-zone {
            background-color: Teal;
        }
        .promise-node.promise-node-not-invoked {
            background-color: lightgray;
        }
        .promise-node.promise-node-raised {
            border-style: solid;
            border-color: red;
            border-width: 2px;
        }


    </style>
</head>
<body ng-app="promiseApp" ng-controller="mainCtrl as main">
<script type="text/ng-template" id="app/promiseTreeHelp.view.html">
    <div class="modal-header">
        <h1 class="modal-title">Playground Help</h1>
    </div>
    <div class="modal-body" style="color: #2C3E50">
        <h2>Javascript code editor pane</h2>
        <div style="margin-left: 10px">
            <p> The Javascript code editor pane is located on the <strong>Playground</strong> page on the left side. It allows you to write javascript promise code and see the results on the right pane.</p>
            <p>You can run your own custom code or use pre defined code examples by selecting an example from the selection box above the top right corner of the editor.</p>
            <p>Once your code has finished you need to notify it to the visualizer so he can render the graph.
                This is done by simply calling the function <strong>createPromiseTree(timeoutMS, callback)</strong>.
                The function has 2 optional parameter:</p>
            <ul>
                <li><strong>timeoutMS:</strong> The time to wait, in milliseconds before rendering the tree.</li>
                <li><strong>callback:</strong> A callback function to invoke once graph is ready.</li>
            </ul>
        </div>
        <p>Currently, <strong><i>PromiseTree Visualizer</i></strong> supports the "fetch" library for invoking XHR request using a promise wrapper. You will need a server that supports CORS requests</p>
        <h2>Graph pane</h2>
        <div style="margin-left: 10px">
            <p>The Graph pane is located on the <strong>Playground</strong> page on the right side.
                <br />The Graph pane allows you to view the promise structure created by your code in 2 ways:</p>
            <p><h3>JSON View</h3></p>
            <div style="margin-left: 5px">
                <p>
                    JSON View is the JSON representation of the graph, collection of Promises with thier associated children. <br />
                    The view will populate automatically once a successful "Run" operation has finished and it is also editable,
                    so you can change values or paste a JSON graph you created locally on your machine either in NodeJS or in your browser
                </p>
            </div>
            <h3>Tree View</h3>
            <div style="margin-left: 10px">
                The "Tree View" is just a graphical representation of the promise tree, it has 2 main building blocks:
                <ul>
                    <li><strong>Promise Node:</strong> Represented by a square, a Promise Node is represents a "Promise" in your code.</li>
                    <li><strong>Link:</strong> Represented by a line, connecting to Promise Node's, a Link is a visual object representing the flow.</li>
                </ul>
                <br/>
                <h4>Tree View Legend</h4>
                <div style="margin-left: 10px">
                    The definitions below reffers to the term "<strong>executer</strong>" multiple times, the executer is a function incharge of resolving or rejecting the promise.
                    Here is the exact definition from the mozilla developer network: <br/>
                    <blockquote>
                        Function object with two arguments resolve and reject. The first argument fulfills the promise, the second argument rejects it. We can call these functions, once our operation is completed.
                    </blockquote>

                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <div class="promise-node promise-node-promise"><span>Promise</span></div>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>Represents a <strong><i>new</i> Promise</strong>, <br />
                                e.g: <code style="color: black;">var p = new Promise(function(resolve, reject) {// executor ...});</code></span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <div class="promise-node promise-node-then"><span>Then</span></div>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>Represents a promise returned by invoking the <strong>Then</strong> function on a Promise instance. ,<br />
                                e.g: <code style="color: black;">var p = Promise.resolve(100).then(function(value) {});</code></span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <div class="promise-node promise-node-catch"><span>Catch</span></div>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>Represents a promise returned by invoking the <strong>Catch</strong> function on a Promise instance. , <br />
                                e.g: <code style="color: black;">var p = Promise.resolve(100).catch(function(err) {});</code></span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <div class="promise-node promise-node-zone"><span>ZonePromise</span></div>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>
                                Represents a promise that runs under the context of a another promise.<br />
                                Think about the example given in the <div class="promise-node promise-node-promise"><span>Promise</span></div> description,
                                A <div class="promise-node promise-node-zone"><span>ZonePromise</span></div> is a new promise created in the scope of the executor.
                                A ZonePromises does not have to resolve before thier parent resolves.<br />
                                A Good example is the <strong>Promise.all</strong> & <strong>Promise.race</strong> promise helpers, Promise.all will resolve once all of his children will resolve, Promise.race will resolve on the first resolve event of his children. </span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <div class="promise-node promise-node-promise promise-node-raised"><span>Promise</span></div>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>
                                Represents <div class="promise-node promise-node-promise promise-node-raised"><span>Promise</span></div> or a <div class="promise-node promise-node-zone promise-node-raised"><span>ZonePromise</span></div>
                                that <strong>rejected</strong> or a <div class="promise-node promise-node-then promise-node-raised"><span>Then</span></div> that throw an error.
                            </span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <div class="promise-node promise-node-not-invoked"><span>XXXXXX</span></div>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>
                                Represents any type of promise that didn't invoke. <br />
                                For <div class="promise-node promise-node-then"><span>Then</span></div> it means that the function supplied never invoked.
                                For <div class="promise-node promise-node-catch"><span>Catch</span></div> it means that no exception occured.
                                By definition <div class="promise-node promise-node-promise"><span>Promise</span></div> & <div class="promise-node promise-node-zone"><span>ZonePromise</span></div> invoke immediately.
                            </span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <span style="font-weight: 700"><span style="color:green">Green</span>/<span style="color:red">Red</span> Links</span>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>
                                Represents a flow from a promise to its successor, the color is set according to the successor.<br/>
                                <strong>Flow:</strong> A Green/Red link describes a flow from the left (parent) to the right (child/successor), i.e: A value or an Exception resolved from the left moved to hanndling on the right.
                            </span>
                        </div>
                    </div>
                    <div class="row legend-row">
                        <div class="col-xs-4 col-sm-3 col-lg-2">
                            <span style="font-weight: 700"><span style="color: blue">Blue</span> Links</span>
                        </div>
                        <div class="col-xs-8 col-sm-9 col-lg-10">
                            <span>
                                Represents a connection between a Promise and promise/s (a.k.a: step-children) called in it's executor scope.
                                The step-children can be called from the direct scope of the executor or any scope of invoked functions down the stack.<br />
                                The flow in this situation is opposite to the flow of a Green/Red link and goes from the right to the left.<br /><br />
                                This is not a physical connection/flow rather then a conceptual one, The Parent promise resolve according to the logic defined in its executor.
                                The logic can take into consideration some, all or none of the step-children promise's it invoked in the process.
                                So the resolved (or rejected) value might or might not involve resolved (or rejected) values from its step-children.

                            </span>
                        </div>
                    </div>
                 </div>
            </div>
        </div>

    </div>
    <div class="modal-footer">
        <button class="btn btn-success" ng-click="$close()">OK</button>
    </div>
</script>
<div class="container-fluid" style="margin: 10px; box-sizing: border-box">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-4">
                <h1 class="pt-header">PromiseTree Visualizer</h1>
            </div>
            <div class="col-xs-12 col-sm-8">
                <ul class="list-inline pt-menu">
                    <li><a href="#/home">Home</a></li>
                    <li><a href="#/playground">Playground</a></li>
                    <li><a href="#/browser">Browser</a></li>
                    <li><a href="#/nodejs">NodeJS</a></li>
                    <li><a ng-click="main.showHelp()">Playground Help</a></li>
                </ul>
            </div>
        </div>
    </div>
    <hr>
    <ng-view></ng-view>

    <script src="app/app.js"></script>
    <script src="app/snippets.js"></script>
    <script src="app/utilsSvc.js"></script>
    <script src="app/d3ptreeDirective.js"></script>

    <script src="app/mainCtrl.js"></script>
    <script src="app/genericCtrl.js"></script>
    <script src="app/playgroundCtrl.js"></script>

</body>
</html>
